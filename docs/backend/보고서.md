## 수행 내역

### ORM를 통한 DB 연동

#### 문제

이전 프로젝트에서는 [**mysql 드라이버**](https://www.npmjs.com/package/mysql)를 통해 DB 작업을 수행하였습니다. 그러나 이러한 방식으로 DB 작업을 수행하게 되었을 다음과 같은 문제가 있었습니다.

- SQL Injection
- 개발자의 쿼리 작성시 실수로 인한 오작동

#### 해결

이러한 문제점을 해결하기 위해 다음과 같은 방법을 생각했습니다.

1. SQL Injection 방지 라이브러리와 DB 작업 함수를 필요한 부분만 구현하여 해결
2. ORM을 사용하여 해결

1번은 별도의 학습이 필요없어 소모되는 시간이 적지만 구현한 DB 접근 함수의 검증을 신경써야 하는 상황이고

2번은 속도 저하, 학습 시간이 늘어나는 문제가 있지만 DB 작업을 수행하는 함수의 검증을 하지 않아도 된다는 장점이 있었습니다.

이러한 방법을 고민하다 **DB작업을 수행하는 함수에 대한 검증하지 않아도 되는 점** 때문에 ORM을 도입하기로 했고 다양한 ORM 라이브러리가 있었으나 **참고 자료가 많고 이슈가 적어** Sequelize를 선택하게 되었습니다.

### 서버 레이어 세분화

#### 문제

미들웨어, 라우팅이 server.ts에 모여있어 유지보수, 가독성면에서 안좋은 부분이 있었습니다. 또한 함수들만 export해서 사용하였기 때문에 함수의 구분과 함수를 이해가 어렵고 이름의 길이가 길어지는 문제점이 있었습니다.

#### 해결

미들웨어, 라우터, 컨트롤러, 서비스, DB로 분리하여 리팩토링을 하게 되었습니다. 또한 각 함수를 클래스로 묶어 함수의 구분을 명확히 하고 함수의 이름을 이해하기 쉽게 수정했습니다.

![alt text](images/layer.drawio.svg)

### 실시간 채팅

#### 문제

배송이 진행되는 동안 의뢰인과 배송원간 연락 수단이 필요 했는데 개인정보 문제로 전화번호 사용은 지양하는 상황이었습니다.

#### 해결

Socket.IO를 이용하여 실시간 채팅 기능을 구현하여 문제점을 해결하였고 MongoDB를 통해 비정형 데이터를 관리했습니다.

### 월간 거리당 평균 의뢰금을 계산하는 스케쥴러

#### 문제

의뢰인이 의뢰금을 책정하기 때문에 배송원의 지역에 따라 의뢰금이 달라져서 배송원은 적정가인지 확인하기 여러운 문제점이 있습니다.

#### 해결

월별로 각 거리당 평균을 계산하는 스케쥴러를 작업하여 배송원이 배송 수락 전 해당 거리에 대한 평균 의뢰금 정보를 제공받을 수 있도록 함으로써 배송원은 해당 의뢰금이 적정가인지 확인할 수 있습니다.

### 수취인에게 배송 정보 제공

#### 문제

배송원이 의뢰를 수락하고 수취인은 아래와 같은 배송에 대한 정보를 제공받아야 합니다.

- 배송원이 배송완료를 하기위한 QR코드
- 실시간 배송원 위치 정보
- 배송 성공/실패 이미지

#### 해결

배송원이 의뢰를 수락할때 수취인에게 배송 정보(위치, 배송완료시 물품 이미지, 배송완료를 위한 QR코드)를 확인할 수 있는 url을 문자로 발송하도록 구현했습니다. 이전에 해외 메시지 서비스를 사용하였으나, 비용, 메시지 전송 속도, 광고등으로 인하여 네이버 클라우드 플랫폼 SMS API를 사용하게 되었습니다.

<details>
  <summary><strong>QR 코드</strong></summary>

#### 문제

배송완료처리를 만들어야 했고 간편한 방법을 적용하고 싶었음

#### 해결

QR코드를 이용하여 배송원이 배송완료 처리가 가능하게 구현

https://github.com/user-attachments/assets/c77f2e0e-df44-4aee-b45c-1118bd8c47ec

</details>

<details>
  <summary><strong>실시간 배송원 위치 정보</strong></summary>

#### 문제

퀵 서비스는 빠르게 물품을 받는게 목적이기 때문에 현재 배송원이 어느 지점까지 왔는지 확인하는게 중요한 문제였습니다.

#### 해결

그래서 수취인은 배송원의 실시간 위치를 조회 가능하도록 구현

https://github.com/user-attachments/assets/3fdd8274-9d69-48ae-beec-14629b16c9cb

</details>

<details>
  <summary><strong>이미지 전송</strong></summary>

#### 문제

배송원과 수취인이 대면하여 배송을 하지 못하는 경우 배송하는 방법이 필요했습니다.

#### 해결

배송완료 사진을 업로드하고 수취인은 배송완료된 사진을 통해 배송완료 사실을 확인할 수 있습니다. 또한 배송 실패시 배송실패 이미지와 배송실패 사유를 수취인에게 전달할 수 있도록 했습니다.

https://github.com/user-attachments/assets/a209e2c2-4f9a-4c19-bb69-af7f10539b13

</details>

### 슬랙봇 메시지

#### 문제

배포한 원격 서버에서 에러가 발생했을때 서버의 상태를 바로 알 수 없는 문제점이 있었습니다. 각자 파트를 나누고 관리하다 보니 팀원들은 원격 서버에 문제가 발생하여도 어떤 상황인지 바로 알기 어려웠습니다.

#### 해결

서버가 에러 발생시 에러에 대한 정보(에러의 이름, 스택 트레이스, 발생 시각)를 메시지 봇이 팀원이 있는 슬랙 채널에 공유하도록 개발했습니다.

### 커스텀 로거 설정

#### 문제

개발환경에서 API 호출에 대한 검증을 위해 요청에대한 로그가 필요했고 일반적인 로그는 가독성이 떨어지는 문제점이 있었습니다.

#### 해결

로그의 확인 가시성을 위해 여러 라이브러리를 조합하여 커스텀 로거를 작업해 가시성을 향상시켰습니다.

### 인프라

- 도메인 적용 및 cloudflare를 통한 DNS 서버 설정
- GCP를 이용한 배포 및 운영

### 기타

- 데이터베이스 설계과정에서 문제점, 정규화, 테이블 구조에 대한 검증 작업을 수행
- 서버, 외부 API를 프론트와 연동

## 개발 후기

### 좋았던 점

장기 팀 프로젝트였기 때문에 프로젝트를 진행하면서 부족한 부분이 있었고 배워야 할 부분이 넓어지는 느낌을 받았습니다. 만약 소규모 단기 프로젝트라면 느끼기 힘든 부분이라고 생각합니다.

팀원과 일정이 같아 쉬는시간이나 점심 시간에 앞으로 처리해야 할 일, 예상되는 문제점, 여러 가지 방법에 대한 고민, 도입하면 괜찮을 기술에 관한 이야기 등을 서로 나눌 수 있었습니다.

다른 과목들이 있었지만 기간이 어느정도 있었기 때문에 사용해보고싶은 기술과 제가 시도싶은걸 할 수 있었습니다.

### 아쉬운 점

팀원별로 각자 파트가 명확했기 때문에 같은 파트의 협업은 없는 상황이었습니다.

기능의 추가가 아닌 유지보수와 다른사람과의 협업을 통해 다른 사람이 보기 좋은 코드를 만약 일종의 페이프로그래밍이 되어 서로에게 도움이 되지 않았을까 합니다.

기존의 개발 문서는 한글 파일로 만들어 유지 보수에 많이 취약했습니다. 이를 보완하기 위한 필요성을 느꼈으며, 문서의 업데이트가 간편한 개발 문서의 필요성을 느꼈습니다.

프로젝트의 설계에서는 기술 도입이나 구현의 근거가 있었지만 나중에 추가적인 요구사항, 변경으로 인해 충분히 고민없이 진행하게 되어 아쉬웠습니다.
